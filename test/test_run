target="$1"
expected="$target".exp
output="$target".all
success="$target".done
executable="$target"_test

export PATH=../../test:$PATH

# Clean previous success and output
rm -f $success $output

# Setup
if ! test_setup; then
	echo "Cannot setup test environment"
	exit 1
fi

# Run
if ! ./$executable > $output 2>&1; then
	exit 2
fi

# Check
if ! diff -q $expected $output; then
	exit 3
fi

# Successs
touch $success
rm -f $output
exit 0
